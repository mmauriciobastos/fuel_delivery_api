# .copilotignore for GitHub Copilot Instructions

# This file contains specific instructions for GitHub Copilot when working on the Fuel Delivery Management Platform

## Project Context
- Multi-tenant SaaS API for fuel delivery companies
- Symfony 7.x + API Platform 4.x + PostgreSQL 16
- PHP 8.3+ with strict typing
- JWT authentication with role-based access control

## Critical Requirements

### Multi-Tenancy (MANDATORY)
- ALL entities MUST have ManyToOne relationship to Tenant entity
- ALL queries automatically filtered by tenant (Doctrine filter handles this)
- UUID primary keys for all entities using UuidGenerator::class
- Tenant context MUST be available in all services

### Entity Pattern
```php
#[ORM\Entity]
class EntityName
{
    #[ORM\Id]
    #[ORM\GeneratedValue(strategy: 'CUSTOM')]
    #[ORM\CustomIdGenerator(class: UuidGenerator::class)]
    private ?Uuid $id = null;

    #[ORM\ManyToOne(targetEntity: Tenant::class)]
    #[ORM\JoinColumn(nullable: false)]
    private ?Tenant $tenant = null;
}
```

### Service Layer (MANDATORY)
- Business logic ONLY in services, never in controllers
- Services inject repositories via constructor
- Use DTOs for complex operations
- Always dispatch events for business actions

### API Platform Pattern
```php
#[ApiResource(
    operations: [
        new GetCollection(security: "is_granted('ROLE_DISPATCHER')"),
        new Post(security: "is_granted('ROLE_DISPATCHER')")
    ],
    normalizationContext: ['groups' => ['entity:read']],
    denormalizationContext: ['groups' => ['entity:write']]
)]
```

### Business Rules
- Orders: pending → assigned → in_transit → delivered
- Only pending orders can be assigned trucks
- Truck capacity must be >= order quantity
- Email unique per tenant (not globally)
- Auto-generate order numbers: ORD-YYYY-####

### Security
- All endpoints require authentication except /api/auth/*
- Role hierarchy: ROLE_ADMIN > ROLE_DISPATCHER > ROLE_USER
- JWT tokens include tenant_id claim
- Use security voters for complex permissions

### Error Handling
- Custom exception classes with meaningful messages
- Global exception listener for consistent responses
- Log errors appropriately

### Testing
- Unit tests for all services
- Integration tests for API endpoints
- Multi-tenant isolation tests mandatory